<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="library.mapper.BoardMapper">
 
<!-- <resultMap type="board" id="boardMap"> -->
<!-- 	<id column = "article_id" property = "articleId" /> -->
<!-- 	<result column = "group_id" property = "groupId" /> -->
<!-- 	<result column = "sequence_no" property = "sequenceNo" /> -->
<!-- 	<result column = "posting_date" property = "postingDate" /> -->
<!-- 	<result column = "read_count" property = "readCount" /> -->
<!-- 	<result column = "writer_name" property = "writerName" /> -->
<!-- 	<result column = "password" property = "password" /> -->
<!-- 	<result column = "title" property = "title" /> -->
<!-- 	<result column = "content" property = "content" /> -->
<!-- </resultMap> -->

<!-- <insert id="insertBoard" parameterType="board"> -->
<!-- 	INSERT INTO article -->
<!-- 	VALUES(SEQ_ARTICLE_ID_ARTICLE.nextval, #{groupId}, #{sequenceNo}, sysdate, 0, #{writerName}, #{password}, #{title}, #{content}) -->
<!-- </insert> -->

<select id="selectBoardByTitle" parameterType="hashmap" resultType="lib_book">
	SELECT book_num, book_title, book_writer, book_publisher, book_genre, reco_num, rent_state
	FROM book, rent
	<where>
		<if test=" bookTitle != null ">
			book_title like '%'||#{bookTitle}||'%' AND book_num = num(+)
		</if>
	</where> 
	ORDER BY book_num
</select>

<select id="selectBoardByWriter" parameterType="hashmap" resultType="lib_book">
	SELECT book_num, book_title, book_writer, book_publisher, book_genre, reco_num, rent_state
	FROM book, rent
	<where>
		<if test=" bookWriter != null ">
			book_writer like '%'||#{bookWriter}||'%' AND book_num = num(+)
		</if>
	</where>
	ORDER BY book_num
</select>

<select id="selectBoardByPublisher" parameterType="hashmap" resultType="lib_book">
	SELECT book_num, book_title, book_writer, book_publisher, book_genre, reco_num, rent_state
	FROM book, rent
	<where>
		<if test=" bookPublisher != null ">
			book_publisher like '%'||#{bookPublisher}||'%' AND book_num = num(+)
		</if>
	</where>
	ORDER BY book_num
</select>

<update id="updateRentStateReserve" parameterType="hashmap">
	UPDATE rent
	SET rent_state = '예약중'
	WHERE num = #{bookNum}
</update>

<insert id="reserve" parameterType="hashmap">
	INSERT INTO reserve
	VALUES (seq_reserve.nextval, '태범', #{rentNum}, to_char(sysdate, 'YYYY-mm-dd'), '예약중')
</insert>

<select id="selectRentNumByBookNum" parameterType="hashmap" resultType="String">
	SELECT rent_num FROM rent WHERE num = #{bookNum}
</select>

<select id="selectIdByBookNum" parameterType="hashmap" resultType="String">
	SELECT id FROM rent WHERE num = #{bookNum}
</select>

<select id="selectReserveById" parameterType="hashmap" resultType="reserve">
	SELECT reserve.reserve_num, reserve.id, book.book_num, book.book_title, to_char(reserve.reserve_date, 'YYYY-MM-DD') reserve_date, to_char(rent.return_schedule, 'YYYY-MM-DD') return_schedule, reserve.reserve_state
	FROM reserve, rent, book
	WHERE reserve.id = #{id} AND reserve.RENT_NUM = rent.RENT_NUM AND rent.num = book.BOOK_NUM
</select>

</mapper>